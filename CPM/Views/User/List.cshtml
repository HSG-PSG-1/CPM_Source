@model PagedList<CPM.DAL.vw_Users_Role_Org>
@using System.Collections
@using Webdiyer.WebControls.Mvc
@using CPM.Services
@using CPM.Helper
@{ ViewBag.Title = "User List"; Layout = Defaults.masterLayout;}
@section HeadContent {
    <script type="text/javascript" language="javascript">
        //var delTR = ""; HT : moved to comon.js as it wil be required at most of the paces
        
        $().ready(function() {
            doAjaxForm('#frm', '#tdGrid', '#doReset'); //AJAXify form
            $('#frm').submit(function() { $("#messages").hide(); });//Hide the message on sub-sequent postback
        });
    </script>
}
@{ CPM.DAL.vw_Users_Role_Org usrSearch = ((CPM.DAL.vw_Users_Role_Org)(ViewData["SearchData"]));
    object routeValues = new { qData = Request["qData"] };
    Dictionary<string, object> txtAttr = new Dictionary<string, object>();
    txtAttr.Add("class", "hdrTxt textBox");
    txtAttr.Add("onchange", "setFiltered(1,this);");
    bool? oprSuccess = ((bool?)ViewData["oprSuccess"]);
}
<table width="100%" border="0">
    <tr>
        <td class="sqz" valign="top">
            <b class="smallHeading">Manage User</b>
        </td>
        <td align="center" style="width: 98%">
            <span id="msg">@Html.ValidationSummary(true)<br /><br />
            @if (oprSuccess.HasValue)
            { @Html.Raw(Defaults.getOprResult(oprSuccess.Value, UserService.delRefChkMsg))} 
            </span>
        </td>
        <td class="sqz" align="right" valign="top">
            @Html.ActionLink("Create New", "AddEdit", new { id = Defaults.Integer })&nbsp;
        </td>
    </tr>
    <tr>
        <td colspan="3">                
            <fieldset>
                <legend onclick="showHideDiv('tblSearch')" style="cursor: pointer">&nbsp;<img id="tblSearchImg"
                    src="@Url.Content("~/Content/Images/aroB.gif")" alt="Show/Hide panel" />
                    &nbsp;Search&nbsp;</legend>
                <form action="@Url.Content("~/Users")" method="post" id="frm" style="display: inline">
                <table id="tblSearch" cellpadding="2" cellspacing="2" border="0" width="100%">
                    <tr>
                        <td nowrap="nowrap" width="5%">Name</td>
                        <td>@Html.TextBox("UserName", usrSearch.UserName, txtAttr)</td>                            
                        <td nowrap="nowrap" width="5%">Email</td>
                        <td>@Html.TextBox("Email", usrSearch.Email, txtAttr)</td>
                        <td nowrap="nowrap" width="5%">Role</td>
                        <td nowrap="nowrap">@Html.DropDownList("RoleID", new SelectList((IEnumerable)ViewData["Roles"], "ID", "TEXT", usrSearch.RoleID), "All Roles", new { @class = "dropDown" })</td>
                        @* Kept for future
                        <td nowrap="nowrap" width="5%">Organization</td>
                        <td>@Html.TextBox("OrgName", usrSearch.OrgName, txtAttr)</td></tr><tr>*@
                        <td nowrap="nowrap"align="right" colspan="6"><input type="submit" value="Search" class="button" />
                            &nbsp;<input type="submit" value="Reset" class="button" onclick="clearForm(document.getElementById('frm')); document.getElementById('doReset').checked = true;" />
                            <input type="checkbox" name="doReset" id="doReset" style="display: none;" />
                        </td>
                    </tr>
                </table>
                </form>
            </fieldset>
            <!-- END: Search Panel -->
        </td>
    </tr>
    <tr>
        <td colspan="3">
                <div id="tdGrid">
                    @* Try in future if needed @{Html.RenderPartial("./EditorTemplates/UserList", Model);}*@
                    @{ Html.RenderAction("UserList", "User"); }
                </div>
        </td>
    </tr>
</table>
<script language="javascript" type="text/javascript" defer="defer">        setFocus("UserName");
    //HT: Make sure this is declared in the user control which is refreshed!
    //var usrCountTD = $("table tfoot tr td #usrCount");
    $().ready(function() {
        doFurtherProcessing = function(success) {            
            if (!success) return; //failed
            usrCountTD.html(parseInt(usrCountTD.text()) - 1).effect('highlight', {}, 2000);
        }
    });
    function doDelPost(txtId, txtVal) {
        var data = {}; data[txtId] = txtVal;
        var url = '@Url.Action("DeleteTaco", "User")';
        $.post(url, data);
        return false; // prevent any postback
    }
</script>
<script src="@Url.Content("~/Content/Scripts/jquery.taconite.js")" type="text/javascript" ></script>
